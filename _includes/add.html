<form
    novalidate
    action="{{ site.urls.find | build_url }}"
    method="POST"
    class="group flex h-full flex-col data-[add-has-results-value=true]:hidden"
    data-controller="add"
    data-add-has-error-value="false"
    data-add-has-results-value="false"
    data-action="
        submit->add#submit:prevent
        app:pageInfoLoaded@window->add#search
    "
>
    <div class="flex grow flex-col items-center justify-center py-8 gap-4 text-500 group-data-[add-has-error-value=true]:hidden">
        {% include shared/spinner.html %}
        <p>Searching for Feeds…</p>
    </div>

    <div class="flex grow flex-col items-center justify-center py-8 gap-4 text-500 hidden group-data-[add-has-error-value=true]:flex">
        {% include shared/icon.html icon="icon-search" class="shrink-0" %}
        <p data-add-target="error" class="text-center"></p>
    </div>
</form>

<form
    novalidate
    action="{{ site.urls.subscribe | build_url }}"
    method="POST"
    class="group hidden h-full flex-col data-[subscribe-has-results-value=true]:flex"
    data-controller="subscribe"
    data-subscribe-has-results-value="false"
    data-subscribe-loading-value="false"
    data-subscribe-results-count-value="0"
    data-action="
        submit->subscribe#submit:prevent
        add:resultsLoaded@window->subscribe#displayResults
    "
>
    {% capture content %}

    {% include shared/error.html content="" attributes="data-subscribe-target='error'" %}

    <h1 class="text-700 mb-2 line-clamp-2 font-bold">Feed<span class="group-data-[subscribe-results-count-value=1]:hidden">s</span></h1>

    <div data-subscribe-target="feedResults"></div>

    <h1 class="text-700 mb-2 line-clamp-2 font-bold">Tags</h1>
    <div class="flex flex-col gap-2">
        <input
            type="text"
            class="text-input placeholder:text-600 focus-visible:placeholder:text-500 mb-2 cursor-pointer border-400 text-center placeholder:font-medium focus-visible:cursor-text focus-visible:border-blue-600 focus-visible:text-left focus-visible:placeholder:font-normal"
            placeholder="+ New Tag"
        />
        <div
            data-subscribe-target="tagResults"
            class="flex flex-col gap-2 empty:hidden"
        ></div>
    </div>

    <template data-subscribe-target="feedTemplate">
        <div class="mb-4 flex">
            <input
                type="hidden"
                data-template="url"
            />
            <label class="flex h-[40px] items-center pr-2">
                <input
                    type="hidden"
                    value="0"
                    data-template="checkbox_dummy"
                />
                {% include shared/checkbox.html attributes="data-template='checkbox' data-subscribe-target='checkbox'
                data-action='change->subscribe#countSelected' value='1'" %}
            </label>
            <div class="min-w-0 grow">
                <input
                    type="text"
                    class="text-input"
                    data-template="feed_input"
                />
                <div class="text-500 mt-1 flex min-w-0 gap-4 text-sm">
                    <div
                        class="grow truncate"
                        data-template="display_url"
                    ></div>
                    <div
                        class="shrink-0"
                        data-template="volume"
                    ></div>
                </div>
            </div>
        </div>
    </template>

    <template data-subscribe-target="tagTemplate">
        <label
            class="group/checkbutton flex min-w-0 cursor-pointer items-center gap-3 rounded border p-3 has-checked:border-600 has-checked:outline-2 has-checked:outline-600"
        >
            {% include shared/checkbox.html attributes="data-template='checkbox' name='tag[]'" %}
            <div
                class="grow truncate"
                data-template="label"
            ></div>
            {% include shared/icon.html icon="icon-tag" class="shrink-0 fill-400 group-has-checked/checkbutton:fill-700" %}
        </label>
    </template>
    {% endcapture %}

    {% capture button %}
    <button
        data-subscribe-target="submitButton"
        type="submit"
        class="primary-button"
    >
        <span class="hidden group-data-[subscribe-loading-value=false]:block"> Subscribe </span>
        <span class="hidden group-data-[subscribe-loading-value=true]:block"> Subscribing… </span>
    </button>
    {% endcapture %}
    {% include shared/tab.html content=content button=button %}
</form>
