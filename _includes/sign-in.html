<form class="group" data-controller="sign-in" data-action="submit->sign-in#submit" data-sign-in-loading-value="false" novalidate>
    {% capture content %}
    <script type="module">
        import { Controller } from "./assets/javascript/lib/stimulus.js"
        Stimulus.register("sign-in", class extends Controller {
            static targets = [ "results", "form", "email", "password", "submitButton", "error" ]
            static values = {
                loading: Boolean
            }

            connect() {
                console.log("sign in");
            }

            async submit(event) {
                event.preventDefault()
                this.submitButtonTarget.disabled = true
                this.loadingValue = true
                this.errorTarget.textContent = ""
                console.log(this.submitButtonTarget);

                const formData = new FormData(this.formTarget);
                let data = new URLSearchParams(formData).toString()
                console.log(data)


                // console.log(this.emailValue);
                // console.log(this.passwordValue);
                // const url = "{{site.api_host}}/sign-in";
                // try {
                //   const response = await fetch(url);
                //   if (!response.ok) {
                //     throw new Error(`Response status: ${response.status}`);
                //   }
                //
                //   const json = await response.json();
                //   this.resultsTarget.textContent = json.amount
                //   console.log(json);
                // } catch (error) {
                //   console.error(error.message);
                // }
            }
        })
        </script>
        <div class="sign-in">
            <div class="flex flex-col gap-4 items-stretch">
                <div data-sign-in-target="error" class="bg-red-200 p-2 rounded text-red-600 mb-2 text-sm empty:hidden"></div>
                <input
                    class="text-input"
                    type="text"
                    name="email"
                    data-sign-in-target="email"
                    placeholder="Email Address"
                    autocorrect="off"
                    autocapitalize="off"
                    spellcheck="false"
                    required
                />
                <input
                    class="text-input"
                    type="password"
                    name="password"
                    data-sign-in-target="password"
                    placeholder="Password"
                />
            </div>

            <span data-sign-in-target="results"></span>
        </div>
    {% endcapture %}
    {% capture button %}
        <button data-sign-in-target="submitButton" type="submit" class="primary-button">
            <span class="hidden group-data-[sign-in-loading-value=false]:block">
                Sign In
            </span>
            <span class="hidden group-data-[sign-in-loading-value=true]:block">
                Loadingâ€¦
            </span>
        </button>
    {% endcapture %}
    {% include shared/tab.html content=content button=button %}
</form>
